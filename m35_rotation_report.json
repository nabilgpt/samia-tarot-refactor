{
  "summary": {
    "started_at": "2025-09-16T11:23:59.671824",
    "type": "scheduled",
    "automated_rotations": 1,
    "manual_rotations_required": 6,
    "initial_tests_passed": false
  },
  "instructions": {
    "timestamp": "2025-09-16T11:23:56.446150",
    "rotation_plan": {
      "1_supabase_keys": {
        "description": "Rotate Supabase anon/service_role/JWT keys",
        "steps": [
          "1. Go to Supabase Dashboard > Settings > API",
          "2. Click \"Rotate anon key\" - copy new key",
          "3. Click \"Rotate service_role key\" - copy new key",
          "4. Update .env.sandbox with new keys",
          "5. Update GitHub Actions secrets",
          "6. Restart services and test"
        ],
        "overlap_window": "5 minutes",
        "rollback": "Keep old keys for 24h, restore if issues"
      },
      "2_stripe_keys": {
        "description": "Rotate Stripe API and webhook secrets",
        "steps": [
          "1. Go to Stripe Dashboard > Developers > API keys",
          "2. Create new restricted key with same permissions",
          "3. Update STRIPE_SECRET_KEY in environment",
          "4. Go to Webhooks section",
          "5. Create new webhook endpoint with same events",
          "6. Update STRIPE_WEBHOOK_SECRET",
          "7. Test webhook signature verification",
          "8. Delete old webhook endpoint after 24h"
        ],
        "overlap_window": "24 hours",
        "rollback": "Switch back to old keys, re-enable old webhook"
      },
      "3_twilio_tokens": {
        "description": "Rotate Twilio auth tokens",
        "steps": [
          "1. Go to Twilio Console > Account > API keys & tokens",
          "2. Create new Main Auth Token",
          "3. Update TWILIO_AUTH_TOKEN in environment",
          "4. Test phone verification and calls",
          "5. Delete old auth token after confirmation"
        ],
        "overlap_window": "1 hour",
        "rollback": "Use backup auth token if available"
      },
      "4_github_secrets": {
        "description": "Audit and update GitHub Actions secrets",
        "steps": [
          "1. Go to Repository > Settings > Secrets and variables > Actions",
          "2. Update DB_DSN with new connection string if rotated",
          "3. Update SUPABASE_* secrets with new keys",
          "4. Remove unused secrets",
          "5. Test workflows with manual trigger"
        ],
        "overlap_window": "Immediate",
        "rollback": "Restore previous secret values"
      }
    },
    "verification_checklist": [
      "Database connections working",
      "Supabase auth endpoints responding",
      "Stripe payment intents creating successfully",
      "Stripe webhooks verifying correctly",
      "Phone verification SMS working",
      "GitHub Actions workflows passing",
      "All API health checks green"
    ],
    "emergency_contacts": {
      "supabase_support": "dashboard.supabase.com/support",
      "stripe_support": "dashboard.stripe.com/support",
      "twilio_support": "help.twilio.com"
    }
  },
  "checklist": {
    "pre_rotation": [
      "\u25a1 Backup current .env.sandbox file",
      "\u25a1 Verify all services are healthy",
      "\u25a1 Prepare rollback procedures",
      "\u25a1 Schedule maintenance window if needed",
      "\u25a1 Notify team of rotation activity"
    ],
    "rotation_execution": [
      "\u25a1 Rotate JOB_TOKEN (internal)",
      "\u25a1 Rotate Supabase service_role key",
      "\u25a1 Rotate Supabase anon key",
      "\u25a1 Rotate Stripe secret key",
      "\u25a1 Rotate Stripe webhook secret",
      "\u25a1 Rotate Twilio auth token",
      "\u25a1 Update GitHub Actions secrets",
      "\u25a1 Restart affected services"
    ],
    "post_rotation": [
      "\u25a1 Run comprehensive smoke tests",
      "\u25a1 Verify webhook signatures",
      "\u25a1 Test payment flows",
      "\u25a1 Test phone verification",
      "\u25a1 Check all API endpoints",
      "\u25a1 Monitor error logs for 1 hour",
      "\u25a1 Update rotation schedule",
      "\u25a1 Document any issues found"
    ],
    "cleanup": [
      "\u25a1 Revoke old keys after 24-48h",
      "\u25a1 Update audit records",
      "\u25a1 Schedule next rotation",
      "\u25a1 Archive rotation logs",
      "\u25a1 Update documentation"
    ]
  },
  "audit_log": [
    {
      "timestamp": "2025-09-16T11:23:56.446129",
      "action": "M35 Key Rotation Started",
      "status": "IN_PROGRESS",
      "details": {
        "type": "scheduled",
        "timestamp": "2025-09-16T11:23:56.446104"
      }
    },
    {
      "timestamp": "2025-09-16T11:23:56.446156",
      "action": "Starting internal token rotation",
      "status": "IN_PROGRESS",
      "details": {}
    },
    {
      "timestamp": "2025-09-16T11:23:56.446162",
      "action": "JOB_TOKEN not found",
      "status": "SKIPPED",
      "details": {}
    },
    {
      "timestamp": "2025-09-16T11:23:59.671492",
      "action": "Smoke tests completed",
      "status": "SUCCESS",
      "details": {
        "passed": "1/3",
        "results": {
          "database_connection": true,
          "supabase_auth": false,
          "api_health": false
        }
      }
    }
  ],
  "next_actions": [
    "Follow the manual rotation instructions for external services",
    "Update GitHub Actions secrets",
    "Run full smoke tests after each rotation",
    "Monitor services for 24 hours",
    "Schedule next rotation in 30-90 days based on priority"
  ]
}